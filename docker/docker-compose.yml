services:
  genjax_cpu:
    build:
      context: ..
      dockerfile: docker/genjax/Dockerfile
    image: crosscat-genjax:latest
    environment:
      - JAX_PLATFORM_NAME=cpu
    volumes:
      - ..:/workspaces/crosscat:cached
      - genjax-uv-cache:/root/.cache/uv
      - ../experiments/artifacts:/workspaces/crosscat/experiments/artifacts
    working_dir: /workspaces/crosscat
    command: ["bash"]

  genjax_gpu:
    extends:
      service: genjax_cpu
    environment:
      - JAX_PLATFORM_NAME=gpu
    # Enable the following if GPU runtime is available:
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - capabilities: [gpu]

  original:
    build:
      context: ..
      dockerfile: docker/original/Dockerfile
    image: crosscat-original:latest
    volumes:
      - ..:/workspaces/crosscat:cached
      - ../experiments/artifacts:/workspaces/crosscat/experiments/artifacts
    working_dir: /workspaces/crosscat
    command: ["bash"]

volumes:
  genjax-uv-cache:
